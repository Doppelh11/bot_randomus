<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script>
  const tg = window.Telegram.WebApp;
  tg.expand();

  // ⬅️ укажите имя вашего бота один раз
  const BOT_USERNAME = "deepseekrbot"; // <-- ваш @бот без @

  // gid приходит через startapp=gid-<ID>
  let gid = null;
  const startParam = tg.initDataUnsafe?.start_param; // напр. "gid-123"
  if (startParam && startParam.startsWith("gid-")) {
    gid = startParam.slice(4);
  }

  const userId = tg.initDataUnsafe?.user?.id;

  let ref = "";
  if (gid && userId && BOT_USERNAME) {
    ref = `https://t.me/${BOT_USERNAME}?start=ref-${gid}-${userId}`;
  } else {
    ref = "Ошибка: не хватает данных (gid/user). Откройте мини-приложение из поста конкурса.";
  }

  document.getElementById("link").textContent = ref;
  document.getElementById("copyBtn").addEventListener("click", async () => {
    try { await navigator.clipboard.writeText(ref); tg.showPopup({title:"Готово", message:"Ссылка скопирована!", buttons:[{type:"close"}]}); }
    catch { tg.showAlert("Не удалось скопировать. Выделите и скопируйте вручную."); }
  });
</script>
