<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Тест видео — белый фон (маска / multiply, fixed)</title>
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{ --fg:#fff; --muted:#b5b6bf; --maxw:1200px }
    *{ box-sizing:border-box }
    html,body{ height:100% }
    body{
      margin:0; color:var(--fg);
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;
      background:radial-gradient(1200px 900px at 20% 20%, #171924 0, #0f1118 50%, #0c0d10 100%);
      display:grid; place-items:center; padding:24px;
    }

    /* Сцена: ВАЖНО — БЕЗ isolation:isolate, чтобы multiply смешивался с фоном body */
    .stage{
      position:relative; width:min(100%, 760px);
      aspect-ratio: 2048 / 1828;
      /* isolation:isolate;  <-- было, удалили */
      filter:drop-shadow(0 40px 120px rgba(0,0,0,.55));
      border-radius:18px; overflow:hidden; /* опционально, для аккуратности */
    }

    /* Только видео */
    .veo{
      position:absolute; inset:0; width:100%; height:100%;
      object-fit:contain; opacity:1; pointer-events:none;

      /* тонкая подгонка при несовпадении размеров (если нужно) */
      --vx:0px; --vy:0px; --vscale:1;
      transform: translate(var(--vx), var(--vy)) scale(var(--vscale));

      /* сначала пробуем маску экрана; если файла нет — включим multiply скриптом */
      -webkit-mask-image: url(assets/screen-mask.png);
      mask-image: url(assets/screen-mask.png);
      -webkit-mask-size: contain;  mask-size: contain;
      -webkit-mask-repeat: no-repeat; mask-repeat: no-repeat;
      -webkit-mask-position: center;  mask-position: center;
    }
    .veo.nomask{ -webkit-mask:none; mask:none; }
    .veo.multiply{ mix-blend-mode: multiply; }

    /* Немного компенсируем затемнение при multiply (по вкусу, можно убрать) */
    .veo.multiply{ filter: brightness(1.04) contrast(1.02); }

    /* Оверлей, если автоплей заблокирован */
    .overlay{
      position:absolute; inset:0; display:grid; place-items:center;
      background:linear-gradient(180deg, #0008, #0004);
      opacity:0; pointer-events:none; transition:opacity .2s ease;
    }
    .overlay.show{ opacity:1; pointer-events:auto }
    .overlay button{
      appearance:none; border:none; background:#ffffff18; color:#fff;
      padding:14px 18px; border-radius:14px; font-weight:700; cursor:pointer;
      backdrop-filter:blur(8px);
    }

    .mode{
      margin-top:14px; color:var(--muted); font-size:14px; text-align:center;
      font-variant-numeric: tabular-nums;
    }
  </style>
</head>
<body>
  <div>
    <div class="stage" id="stage">
      <video id="veo" class="veo" playsinline muted loop autoplay preload="auto" poster="">
        <!-- твой mp4 -->
        <source src="https://doppelh11.github.io/sitewb/assets/veo.mp4" type="video/mp4">
      </video>

      <div id="overlay" class="overlay">
        <button id="playBtn">▶︎ Воспроизвести</button>
      </div>
    </div>
    <div id="mode" class="mode">Режим: определяем…</div>
  </div>

  <script>
    (function(){
      const video   = document.getElementById('veo');
      const overlay = document.getElementById('overlay');
      const playBtn = document.getElementById('playBtn');
      const modeEl  = document.getElementById('mode');

      // Проверяем наличие маски: если 404 — выключаем mask и включаем multiply (для белого фона)
      function ensureMaskOrMultiply(){
        return new Promise((resolve) => {
          const img = new Image();
          img.onload  = () => { modeEl.textContent = 'Режим: mask (PNG)'; resolve('mask'); };
          img.onerror = () => {
            video.classList.add('nomask','multiply'); // белый фон → multiply
            modeEl.textContent = 'Режим: mix-blend: multiply (без маски)';
            resolve('multiply');
          };
          img.src = 'assets/screen-mask.png';
        });
      }

      // Автоплей: если заблокирован — покажем кнопку
      async function tryAutoplay(v){
        try{ await v.play(); }
        catch(e){ overlay.classList.add('show'); }
      }
      playBtn.addEventListener('click', async () => {
        overlay.classList.remove('show');
        try{ await video.play(); }catch(e){}
      });

      (async function start(){
        await ensureMaskOrMultiply();
        await tryAutoplay(video);
      })();
    })();
  </script>
</body>
</html>
