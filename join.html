<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å ‚Äî —Ä–æ–∑—ã–≥—Ä—ã—à</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#0f1115; --card:#141826; --text:#e8eefc; --muted:#93a2bb; --accent:#7aa2ff;
      --ok:#6dd3a6; --err:#ff7b7b; --ring:#26304a;
    }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
    .wrap{max-width:720px;margin:0 auto;padding:20px}
    .card{background:var(--card);border-radius:18px;padding:22px;box-shadow:0 8px 32px rgba(0,0,0,.25)}
    h1{margin:0 0 6px;font-size:22px}
    .muted{color:var(--muted)}

    /* Capsule button */
    .cta{position:relative;display:flex;align-items:center;justify-content:center;width:100%;height:56px;border-radius:999px;border:none;cursor:pointer;font-weight:700;font-size:16px;background:linear-gradient(180deg,#88b0ff,#6e9bff);color:#0a0f16;box-shadow:0 8px 14px rgba(122,162,255,.35);}
    .cta:active{transform:translateY(1px)}
    .cta .shine{position:absolute;inset:0;border-radius:inherit;background:linear-gradient(120deg,rgba(255,255,255,.35),rgba(255,255,255,0) 30% 70%,rgba(255,255,255,.35));mix-blend-mode:soft-light;opacity:.6}

    /* Lototron */
    .stage{position:relative;height:180px;margin-top:18px;border-radius:16px;background:rgba(255,255,255,.03);outline:1px solid rgba(255,255,255,.06);overflow:hidden}
    .drum{position:absolute;left:50%;top:20px;width:220px;height:120px;margin-left:-110px;border-radius:999px;background:rgba(255,255,255,.04);backdrop-filter:blur(2px);border:1px solid rgba(255,255,255,.07);display:flex;align-items:center;justify-content:center;overflow:hidden}
    .balls{position:absolute;inset:0}
    .ball{position:absolute;width:26px;height:26px;border-radius:50%;background:#7aa2ff20;border:1px solid #7aa2ff44}

    /* Capsule physics */
    .capsule{position:absolute;left:50%;top:-70px;width:148px;height:46px;margin-left:-74px;border-radius:999px;background:linear-gradient(180deg,#88b0ff,#6e9bff);box-shadow:0 8px 14px rgba(122,162,255,.35);display:flex;align-items:center;justify-content:center;color:#0a0f16;font-weight:800}
    .drop{animation:drop 600ms cubic-bezier(.2,.9,.2,1) forwards}
    .bounce{animation:bounce 420ms ease-out forwards}
    @keyframes drop{0%{transform:translateY(0) scale(1)}100%{transform:translateY(120px) scale(.98)}}
    @keyframes bounce{0%{transform:translateY(120px) scale(.98)}60%{transform:translateY(108px) scale(1.02)}100%{transform:translateY(112px) scale(1)}}

    /* Ring checks */
    .ring{position:relative;width:72px;height:72px;margin:16px auto;border-radius:50%;box-shadow:inset 0 0 0 6px var(--ring)}
    .ring .seg{position:absolute;inset:-6px;border-radius:50%;clip-path:polygon(50% 50%, 100% 50%, 100% 0, 50% 0)}
    .ring .seg.ok{box-shadow:inset 0 0 0 6px var(--ok)}

    .result{display:none;margin-top:14px;text-align:center}
    .result.ok{display:block}
    .result .big{font-weight:800}

    .actions{display:flex;gap:8px;margin-top:12px}
    .btn{flex:1;border-radius:12px;border:1px solid #2a3247;background:#1b2133;color:var(--text);padding:12px;font-weight:600;cursor:pointer;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üéâ –£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</h1>
      <div class="muted">–†–æ–∑—ã–≥—Ä—ã—à <span id="gid">#‚Ä¶</span></div>

      <button id="join" class="cta">
        <span>–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å</span>
        <span class="shine"></span>
      </button>

      <div class="stage" id="stage" aria-hidden="true">
        <div class="drum">
          <div class="balls" id="balls"></div>
        </div>
        <div class="capsule" id="capsule">–ó–∞—è–≤–∫–∞</div>
      </div>

      <div id="ring" class="ring" aria-hidden="true"></div>

      <div id="resultOk" class="result">
        <div class="big">‚úÖ –í—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ!</div>
        <div class="muted" id="afterText">–ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –±–æ—Ç—É. –ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Äî –±–æ—Ç –ø–æ–¥—Å–∫–∞–∂–µ—Ç –≤ –ª–∏—á–∫–µ.</div>
        <div class="actions">
          <a class="btn" id="openBot">–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</a>
          <a class="btn" id="share">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</a>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const WebApp = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  WebApp && (WebApp.ready(), WebApp.expand(), WebApp.disableVerticalSwipes && WebApp.disableVerticalSwipes());

  const BOT_USERNAME = 'deepseekrbot';

  const qs = new URLSearchParams(location.search);
  const startParam = (WebApp && WebApp.initDataUnsafe && WebApp.initDataUnsafe.start_param) || qs.get('tgWebAppStartParam') || '';
  const gidMatch = /gid-(\d+)/.exec(startParam || '');
  const gid = gidMatch ? gidMatch[1] : null;
  const user = WebApp && WebApp.initDataUnsafe && WebApp.initDataUnsafe.user ? WebApp.initDataUnsafe.user : null;

  const gidEl = document.getElementById('gid');
  gidEl.textContent = gid ? ('#' + gid) : '#‚Äî';

  const joinBtn = document.getElementById('join');
  const stage = document.getElementById('stage');
  const capsule = document.getElementById('capsule');
  const balls = document.getElementById('balls');
  const ring = document.getElementById('ring');
  const resultOk = document.getElementById('resultOk');
  const openBot = document.getElementById('openBot');
  const share = document.getElementById('share');

  function haptic(type){ try{ WebApp && WebApp.HapticFeedback && WebApp.HapticFeedback[type] && WebApp.HapticFeedback[type]('medium'); }catch{} }

  // Make some "bouncing" balls in the drum
  function spawnBalls(){
    balls.innerHTML = '';
    const n = 14;
    for(let i=0;i<n;i++){
      const b = document.createElement('div');
      b.className = 'ball';
      b.style.left = (10 + Math.random()*180) + 'px';
      b.style.top  = (10 + Math.random()*90) + 'px';
      b.style.transform = 'translate(0,0)';
      balls.appendChild(b);
    }
    // simple perpetual jitter
    const nodes = Array.from(balls.children);
    nodes.forEach((el,idx)=>{
      const dx = (Math.random()*2-1)*20, dy=(Math.random()*2-1)*16;
      el.animate([{transform:'translate(0,0)'},{transform:`translate(${dx}px,${dy}px)`},{transform:'translate(0,0)'}], {duration:1200+idx*30,iterations:2});
    });
  }

  function paintRing(progress){
    ring.innerHTML = '';
    const seg = document.createElement('div'); seg.className = 'seg ok';
    seg.style.background = 'conic-gradient(var(--ok) '+(progress*360)+'deg, transparent '+(progress*360)+'deg)';
    ring.appendChild(seg);
  }

  async function playSequence(){
    // 1) visual: capsule drop into drum
    stage.style.opacity = 1;
    capsule.classList.add('drop');
    haptic('impactOccurred');
    await new Promise(r=>setTimeout(r,620));
    capsule.classList.add('bounce');
    spawnBalls();

    // 2) ring progress for checks
    ring.style.display='block';
    for (let p of [0.33, 0.66, 1]){ paintRing(p); await new Promise(r=>setTimeout(r, 320)); }

    // 3) send to bot
    try{
      const payload = { action:'join', gid, init: WebApp && WebApp.initData || '' };
      WebApp && WebApp.sendData && WebApp.sendData(JSON.stringify(payload));
      haptic('notificationOccurred');
    }catch(e){ /* ignore */ }

    // 4) show success (optimistic)
    resultOk.classList.add('ok');
  }

  joinBtn.addEventListener('click', ()=>{
    if (!gid){
      alert('–ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–ø—É—Å–∫–∞. –û—Ç–∫—Ä–æ–π—Ç–µ –∏–∑ –ø–æ—Å—Ç–∞ –∫–æ–Ω–∫—É—Ä—Å–∞.');
      return;
    }
    joinBtn.disabled = true;
    playSequence();
  });

  openBot.addEventListener('click', ()=>{
    const url = `https://t.me/${BOT_USERNAME}`;
    if (WebApp && WebApp.openTelegramLink){ WebApp.openTelegramLink(url); }
    else { location.href = url; }
  });

  share.addEventListener('click', ()=>{
    const text = `–Ø —É—á–∞—Å—Ç–≤—É—é –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ #${gid}!`; 
    if (navigator.share){ navigator.share({ text }); }
    else if (WebApp && WebApp.openTelegramLink){ WebApp.openTelegramLink(`https://t.me/share/url?text=${encodeURIComponent(text)}`); }
    else { alert(text); }
  });
})();
</script>
</body>
</html>