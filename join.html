<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å ‚Äî —Ä–æ–∑—ã–≥—Ä—ã—à</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root{
      --bg:#0f1115; --card:#141826; --text:#e8eefc; --muted:#93a2bb; --accent:#7aa2ff;
      --ok:#6dd3a6; --err:#ff7b7b; --ring:#26304a;
    }
    html,body{height:100%}
    body{margin:0; background:var(--bg); color:var(--text); font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial}
    .wrap{max-width:720px;margin:0 auto;padding:20px}
    .card{background:var(--card);border-radius:18px;padding:22px;box-shadow:0 8px 32px rgba(0,0,0,.25)}
    h1{margin:0 0 6px;font-size:22px}
    .muted{color:var(--muted)}

    /* Roulette */
    .roulette-wrap{position:relative;margin-top:16px;height:280px}
    .wheel-box{position:absolute;left:50%;top:0;transform:translateX(-50%);width:260px;height:260px;border-radius:50%;background:radial-gradient(closest-side,#1a2236,#0f1524);display:grid;place-items:center;box-shadow:0 12px 40px rgba(0,0,0,.45), inset 0 0 0 8px #0c1120, inset 0 0 0 12px #222b43}
    .wheel{width:220px;height:220px;border-radius:50%;overflow:hidden;position:relative}
    .marker{position:absolute;left:50%;top:-6px;transform:translateX(-50%);width:0;height:0;border-left:10px solid transparent;border-right:10px solid transparent;border-bottom:14px solid #ffd06b;filter:drop-shadow(0 2px 2px rgba(0,0,0,.4))}
    .center{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:62px;height:62px;border-radius:50%;background:linear-gradient(180deg,#88b0ff,#6e9bff);box-shadow:0 4px 10px rgba(122,162,255,.4)}
    .label{position:absolute;left:50%;bottom:8px;transform:translateX(-50%);font-weight:700;letter-spacing:.2px}

    /* Segments */
    .seg{position:absolute;left:0;top:0;width:100%;height:100%;clip-path:polygon(50% 50%, 100% 50%, 100% 0, 50% 0);transform-origin:50% 50%}
    .seg:nth-child(odd){background:#203054}
    .seg:nth-child(even){background:#2a3a64}
    .seg b{position:absolute;right:10px;top:10px;font-size:12px;color:#a9b7d4;opacity:.8}

    /* Spinner state */
    .spin{animation:spin 2200ms cubic-bezier(.17,.84,.21,1) forwards}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(980deg)}} /* ~2.7 turns */

    /* Progress ring for checks */
    .ring{position:relative;width:76px;height:76px;margin:18px auto;border-radius:50%;box-shadow:inset 0 0 0 6px var(--ring)}
    .ring .seg-ok{position:absolute;inset:-6px;border-radius:50%;background:conic-gradient(var(--ok) 0deg, transparent 0deg)}

    .result{display:none;margin-top:14px;text-align:center}
    .result.ok{display:block}
    .result .big{font-weight:800}

    .actions{display:flex;gap:8px;margin-top:12px}
    .btn{flex:1;border-radius:12px;border:1px solid #2a3247;background:#1b2133;color:var(--text);padding:12px;font-weight:600;cursor:pointer;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>üé∞ –£—á–∞—Å—Ç–∏–µ –æ—Ñ–æ—Ä–º–ª—è–µ—Ç—Å—è‚Ä¶</h1>
      <div class="muted">–†–æ–∑—ã–≥—Ä—ã—à <span id="gid">#‚Ä¶</span> ¬∑ –ø—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è</div>

      <div class="roulette-wrap">
        <div class="wheel-box">
          <div class="marker"></div>
          <div id="wheel" class="wheel"></div>
          <div class="center"></div>
          <div class="label" id="label">–ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–æ–¥–ø–∏—Å–∫–∏‚Ä¶</div>
        </div>
      </div>

      <div id="ring" class="ring" aria-hidden="true"><div id="ringOk" class="seg-ok"></div></div>

      <div id="resultOk" class="result">
        <div class="big">‚úÖ –ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º, –≤—ã —É—á–∞—Å—Ç–≤—É–µ—Ç–µ –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ!</div>
        <div class="muted" id="afterText">–ï—Å–ª–∏ —É—Å–ª–æ–≤–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω—ã ‚Äî –±–æ—Ç –Ω–∞–ø–∏—à–µ—Ç, —á—Ç–æ –µ—â—ë –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å.</div>
        <div class="actions">
          <a class="btn" id="openBot">–û—Ç–∫—Ä—ã—Ç—å –±–æ—Ç–∞</a>
          <a class="btn" id="share">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –¥—Ä—É–≥—É</a>
        </div>
      </div>
    </div>
  </div>

<script>
(function(){
  const WebApp = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
  WebApp && (WebApp.ready(), WebApp.expand(), WebApp.disableVerticalSwipes && WebApp.disableVerticalSwipes());

  const BOT_USERNAME = 'deepseekrbot';

  const qs = new URLSearchParams(location.search);
  const startParam = (WebApp && WebApp.initDataUnsafe && WebApp.initDataUnsafe.start_param) || qs.get('tgWebAppStartParam') || '';
  const gidMatch = /gid-(\d+)/.exec(startParam || '');
  const gid = gidMatch ? gidMatch[1] : null;
  const gidEl = document.getElementById('gid');
  gidEl.textContent = gid ? ('#' + gid) : '#‚Äî';

  const wheel = document.getElementById('wheel');
  const label = document.getElementById('label');
  const ring = document.getElementById('ring');
  const ringOk = document.getElementById('ringOk');
  const res = document.getElementById('resultOk');
  const openBot = document.getElementById('openBot');
  const share = document.getElementById('share');

  function haptic(type){ try{ WebApp && WebApp.HapticFeedback && WebApp.HapticFeedback[type] && WebApp.HapticFeedback[type]('medium'); }catch{} }

  // --- build roulette segments (12 sectors) ---
  const SEGS = 12;
  for(let i=0;i<SEGS;i++){
    const s = document.createElement('div');
    s.className = 'seg';
    s.style.transform = `rotate(${(360/SEGS)*i}deg)`;
    const b = document.createElement('b');
    b.textContent = i%2? '√ó' : '‚úì';
    s.appendChild(b);
    wheel.appendChild(s);
  }

  // spin immediately on load
  function spin(){
    wheel.classList.add('spin');
    haptic('impactOccurred');
  }

  function setRing(p){
    ringOk.style.background = `conic-gradient(var(--ok) ${p*360}deg, transparent ${p*360}deg)`;
  }

  function sendJoin(){
    try{
      const payload = { action:'join', gid, init: WebApp && WebApp.initData || '' };
      WebApp && WebApp.sendData && WebApp.sendData(JSON.stringify(payload));
    }catch(e){}
  }

  async function flow(){
    if (!gid){
      label.textContent = '–ù–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∑–∞–ø—É—Å–∫–∞';
      return;
    }
    // 1) spin ~2.2s
    spin();
    await new Promise(r=>setTimeout(r, 2200));

    // 2) show checks progress ~1s
    ring.style.display = 'block';
    label.textContent = '–ü—Ä–æ–≤–µ—Ä—è–µ–º —É—Å–ª–æ–≤–∏—è‚Ä¶';
    for (let p of [0.33, 0.66, 1]){ setRing(p); await new Promise(r=>setTimeout(r, 330)); }

    // 3) submit to bot and show success
    sendJoin();
    haptic('notificationOccurred');
    label.textContent = '–ì–æ—Ç–æ–≤–æ!';
    res.classList.add('ok');
  }

  flow();

  openBot.addEventListener('click', ()=>{
    const url = `https://t.me/${BOT_USERNAME}`;
    if (WebApp && WebApp.openTelegramLink){ WebApp.openTelegramLink(url); }
    else { location.href = url; }
  });

  share.addEventListener('click', ()=>{
    const text = gid ? `–Ø —É—á–∞—Å—Ç–≤—É—é –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ #${gid}!` : '–Ø —É—á–∞—Å—Ç–≤—É—é –≤ —Ä–æ–∑—ã–≥—Ä—ã—à–µ!';
    if (navigator.share){ navigator.share({ text }); }
    else if (WebApp && WebApp.openTelegramLink){ WebApp.openTelegramLink(`https://t.me/share/url?text=${encodeURIComponent(text)}`); }
    else { alert(text); }
  });
})();
</script>
</body>
</html>
