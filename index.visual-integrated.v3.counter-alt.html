<!DOCTYPE html>
<html data-theme="dark" lang="ru">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <title>Инфографика и оформление карточек — hero + visual scene + progress</title>
  <meta content="Крупная типографика, анимация сцен, прогресс-счётчик поверх сцены." name="description"/>
  <!-- Прелоад APNG для мобильных -->
  <link id="visual-preload-apng" rel="preload" as="image" href="assets/veo.apng"/>

  <style id="visual-hero-styles">
  /* ===== Базовая сетка и hero (сокращённо) ===== */
  :root{ --bg:#121014; --text:#f6f8fb; --muted:#a7b0be; --border:rgba(255,255,255,.12); }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial}
  .wrap{max-width:1200px;margin:0 auto;padding:0 32px}
  .hero{position:relative;min-height:85vh;display:flex;flex-direction:column;justify-content:flex-start;padding-top:72px}
  .hero-inner{display:flex;justify-content:space-between;align-items:center;gap:28px;flex:1}
  .hero-text{flex:1;max-width:55%}
  .hero-text h1{font-size:clamp(38px,6vw,70px);font-weight:900;line-height:1.08;margin:0 0 12px}
  .hero-text .lead{margin:0 0 18px;color:var(--muted);font-size:clamp(15px,1.4vw,20px)}
  .hero-image{flex:1;max-width:45%;position:relative;display:flex;justify-content:center;align-items:center}
  @media (max-width: 900px){ .hero-inner{flex-wrap:wrap} .hero-text,.hero-image{max-width:100%} }

  /* ===== Сцена (прозрачная к фону hero) ===== */
  .hero .stage{
    position:relative; width:100%; max-width:760px;
    aspect-ratio: 2048 / 1828;
    margin-inline:auto; isolation:isolate;
    filter:drop-shadow(0 40px 120px rgba(0,0,0,.55));
    perspective:1200px; contain:layout paint;
    background: transparent;
  }
  .hero .layer{
    position:absolute; inset:0; width:100%; height:100%;
    object-fit:contain; object-position:50% 50%;
    transform-style:preserve-3d; backface-visibility:hidden;
    transform-origin:50% 50%;
    will-change:transform,opacity,filter; opacity:0;
  }
  .hero .device, .hero .s1, .hero .s2, .hero .s3, .hero .s4, .hero .s5,
  .hero .veo {
    transform: translateZ(0) scaleX(var(--scale-x,1)) scaleY(var(--scale-y,1));
    z-index:6;
  }
  .hero .device, .hero .s1, .hero .s2, .hero .s3, .hero .s4, .hero .s5{
    /* анти-кайма по углам PNG */
    clip-path: inset(var(--edge, 2px));
  }
  .hero .veo{
    clip-path: inset(var(--clip-t,0) var(--clip-r,0) var(--clip-b,0) var(--clip-l,0));
    z-index:4; opacity:0;
  }
  .hero .veo.webp{ display:block; }
  .hero .veo.apng{ display:none; }
  @media (pointer:coarse), (max-width:820px){
    .hero .veo.webp{ display:none !important; }
    .hero .veo.apng{ display:block !important; }
  }

  /* === Progress badge overlay (НОВЫЙ СЧЁТЧИК) — ровно над сценой, центр по горизонтали === */
  .hero .progress-layer{
    position:absolute; inset:0; pointer-events:none; z-index:10;
    display:flex; justify-content:center; align-items:flex-start;
    padding-top: clamp(8px, 2.2vw, 18px); /* «ровно над» — небольшой отступ от верхней кромки сцены */
  }
  .hero .progress-badge{
    background: rgba(18,20,26,.55);
    color:#e8eefc;
    border-radius:14px;
    padding:10px 14px;
    font-weight:800;
    backdrop-filter: blur(8px) saturate(120%);
    box-shadow: 0 10px 26px rgba(0,0,0,.35), inset 0 0 0 1px rgba(140,160,200,.25);
    opacity:0; transform: translateY(-6px) scale(.94);
    display:flex; flex-direction:column; gap:6px; min-width:180px;
  }
  .hero .progress-badge .label{
    font-size:12px; color:#b8c6e8; text-transform:uppercase; letter-spacing:.06em;
  }
  .hero .progress-badge .bar{
    width:100%; height:6px; background: rgba(255,255,255,.14);
    border-radius:5px; overflow:hidden;
  }
  .hero .progress-badge .bar .fill{
    width:0%; height:100%;
    background: linear-gradient(90deg,#4fd1c5,#7c83ff);
    border-radius:5px;
  }
  </style>
</head>
<body>
  <main class="wrap">
    <section class="hero">
      <div class="hero-inner">
        <div class="hero-text">
          <h1>Не картинки для галочки. <br>Инструменты роста продаж.</h1>
          <p class="lead">Оформляем карточки так, чтобы они повышали CTR и конверсию, и проходили модерацию без проблем.</p>
        </div>

        <div class="hero-image">
          <div class="stage" id="stage" aria-hidden="true">

            <!-- Прогресс-счётчик: центрировано, ровно над сценой -->
            <div class="progress-layer" aria-hidden="true">
              <div class="progress-badge" id="progress_badge">
                <span class="label">Performance</span>
                <div class="bar"><div class="fill"></div></div>
              </div>
            </div>

            <!-- Пошаговые PNG-слои -->
            <img class="layer device" src="assets/step1.png" alt="frame">
            <img class="layer s1" src="assets/step2.png" alt="">
            <img class="layer s2" src="assets/step3.png" alt="">
            <img class="layer s3" src="assets/step4.png" alt="">
            <img class="layer s4" src="assets/step5.png" alt="">
            <img class="layer s5" src="assets/step6.png" alt="">

            <!-- Desktop WEBP -->
            <img class="layer veo webp" id="veo_webp" src="assets/veo.webp" alt="" aria-hidden="true" loading="eager" fetchpriority="high">
            <!-- Mobile APNG — src подставит JS -->
            <img class="layer veo apng" id="veo_apng" data-src="assets/veo.apng" alt="" aria-hidden="true">
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- GSAP -->
  <script src="https://cdn.jsdelivr.net/npm/gsap@3/dist/gsap.min.js"></script>

  <!-- Сценарий сцены с заменой счётчика на progress-bar -->
  <script id="visual-hero-script">
  (() => {
    const REF_W=2048, REF_H=1828;
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const isMobile = window.matchMedia('(pointer: coarse), (max-width: 820px)').matches;
    const webp = document.getElementById('veo_webp');
    let   apng = document.getElementById('veo_apng');

    /* === НОВЫЕ функции счётчика: прогресс-бар === */
    function showBadge(val){
      const badge = document.getElementById('progress_badge');
      const fill  = badge ? badge.querySelector('.fill') : null;
      const target = Math.max(0, Math.min(100, Math.round((val||0)*10))); // 1.3 -> 13%
      if (!window.gsap || !badge || !fill) return (window.gsap && gsap.timeline) ? gsap.timeline() : null;
      return gsap.timeline()
        .set(badge,{opacity:0, scale:.94, y:-6})
        .to(badge,{opacity:1, scale:1, y:0, duration:0.24, ease:'back.out(2)'})
        .to(fill,{width: target + '%', duration:0.9, ease:'power2.out'}, '<')
        .to(badge,{opacity:0, y:-8, scale:.96, duration:0.22, ease:'power2.in'}, '+=0.8');
    }
    function showHeroBadge(){
      const badge = document.getElementById('progress_badge');
      const fill  = badge ? badge.querySelector('.fill') : null;
      if (!window.gsap || !badge || !fill) return (window.gsap && gsap.timeline) ? gsap.timeline() : null;
      return gsap.timeline()
        .set(badge,{opacity:0, scale:.94, y:-6})
        .to(badge,{opacity:1, scale:1, y:0, duration:0.28, ease:'back.out(1.8)'})
        .to(fill,{width:'100%', duration:1.0, ease:'power2.out'}, '>-0.1')
        .to(badge,{opacity:0, y:-6, duration:0.28, ease:'power2.in'}, '+=1.0');
    }

    function applyClip(img){
      const nw=img.naturalWidth||REF_W, nh=img.naturalHeight||REF_H;
      const ar=nw/nh, ref=REF_W/REF_H;
      if(Math.abs(ar-ref)<0.0001){
        img.style.setProperty('--clip-t','0'); img.style.setProperty('--clip-b','0');
        img.style.setProperty('--clip-l','0'); img.style.setProperty('--clip-r','0'); return;
      }
      if(ar>ref){ const visibleW=REF_W/REF_H*nh; const side=Math.max(0,(nw-visibleW)/2/nw)*100;
        img.style.setProperty('--clip-l',side+'%'); img.style.setProperty('--clip-r',side+'%');
        img.style.setProperty('--clip-t','0'); img.style.setProperty('--clip-b','0');
      } else { const visibleH=REF_H/REF_W*nw; const top=Math.max(0,(nh-visibleH)/2/nh)*100;
        img.style.setProperty('--clip-t',top+'%'); img.style.setProperty('--clip-b',top+'%');
        img.style.setProperty('--clip-l','0'); img.style.setProperty('--clip-r','0'); }
    }

    /* APNG prefetch */
    let apngPrefetched=false, apngBlobURL=null;
    async function backgroundPreloadAPNG(){
      if (apngPrefetched || !apng) return;
      const url = apng.getAttribute('data-src'); if(!url) return;
      try{
        const res=await fetch(url,{cache:'force-cache'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        const blob=await res.blob();
        apngBlobURL = URL.createObjectURL(blob);
        apngPrefetched=true;
      }catch(_){}
    }
    function whenReady(img, t=4000){
      const p=('decode' in img)
        ? img.decode().catch(()=> new Promise(r=> img.complete ? r() : img.addEventListener('load', r, {once:true})))
        : new Promise(r=> img.complete ? r() : img.addEventListener('load', r, {once:true}));
      return Promise.race([p, new Promise((_,rej)=>setTimeout(()=>rej(Error('timeout')),t))]);
    }
    async function showApngFromZero(){
      if (!apng) return;
      const dataURL = apng.getAttribute('data-src'); if(!dataURL) return;
      if(!apngPrefetched) { try{ await backgroundPreloadAPNG(); }catch(_){ } }
      const fresh = apng.cloneNode(false);
      fresh.removeAttribute('src'); fresh.style.opacity='0';
      fresh.setAttribute('loading','eager'); fresh.setAttribute('fetchpriority','high');
      fresh.src = apngBlobURL || dataURL;
      try{
        await whenReady(fresh,5000); apng.replaceWith(fresh); apng=fresh;
        if (apng.complete) applyClip(apng); else apng.addEventListener('load',()=>applyClip(apng),{once:true});
        gsap.to(apng,{opacity:1,duration:0.28,delay:0.04});
        if(apngBlobURL){ setTimeout(()=>{ URL.revokeObjectURL(apngBlobURL); apngBlobURL=null; },3000); }
      }catch(_){
        apng.src=dataURL; apng.addEventListener('load',()=>applyClip(apng),{once:true});
        gsap.to(apng,{opacity:1,duration:0.28,delay:0.04});
      }
    }

    function buildTimeline(){
      const tl=gsap.timeline({defaults:{ease:'power3.out'}});
      gsap.set('.device',{opacity:0,yPercent:4,scale:0.985,rotateZ:-1,filter:'blur(6px)'});
      gsap.set(['.s1','.s2','.s3','.s4','.s5'],{opacity:0,yPercent:3,rotateX:4,rotateZ:-1,scale:0.99});
      gsap.set('.veo',{opacity:0});

      tl.to('.device',{opacity:1,yPercent:0,scale:1,rotateZ:0,filter:'blur(0px)',duration:0.55,ease:'back.out(1.6)'});
      tl.to('.s1',{opacity:1,yPercent:0,rotateX:0,rotateZ:0,scale:1,duration:1.2,ease:'back.out(1.4)'}, '-=0.15').add(()=>showBadge(1.3), '>-0.02');
      tl.to('.s2',{opacity:1,yPercent:0,rotateX:0,rotateZ:0,scale:1,duration:1.1,ease:'back.out(1.4)'}, '-=0.10').add(()=>showBadge(2.3), '>-0.02');
      tl.to('.s3',{opacity:1,yPercent:0,rotateX:0,rotateZ:0,scale:1,duration:1.0,ease:'back.out(1.4)'}, '-=0.10').add(()=>showBadge(2.6), '>-0.02');
      tl.to('.s4',{opacity:1,yPercent:0,rotateX:0,rotateZ:0,scale:1,duration:0.9,ease:'back.out(1.4)'}, '-=0.10').add(()=>showBadge(3.3), '>-0.02');
      tl.to('.s5',{opacity:1,yPercent:0,rotateX:0,rotateZ:0,scale:1,duration:0.8,ease:'back.out(1.4)'}, '-=0.10');

      tl.add('switchMedia');
      tl.call(async ()=>{
        if(!isMobile){
          if (webp.complete) applyClip(webp); else webp.addEventListener('load',()=>applyClip(webp),{once:true});
          gsap.to(['.device','.s1','.s2','.s3','.s4','.s5'],{opacity:0,duration:0.25});
          gsap.to(webp,{opacity:1,duration:0.25,delay:0.05});
          setTimeout(()=>{ showHeroBadge(); },1200);
        } else {
          gsap.to(['.device','.s1','.s2','.s3','.s4','.s5'],{opacity:0,duration:0.1});
          await showApngFromZero();
          setTimeout(()=>{ showHeroBadge(); },1200);
        }
      }, null, 'switchMedia');

      return tl;
    }

    function init(){
      if(prefersReduced){
        document.querySelectorAll('.layer').forEach(el=>{
          el.style.opacity = (el.classList.contains('veo')?1:0);
          el.style.transform='none'; el.style.filter='none';
        });
        return;
      }
      backgroundPreloadAPNG();
      if (document.readyState === 'complete') buildTimeline();
      else window.addEventListener('load', ()=>buildTimeline(), {once:true});
    }
    init();
  })();
  </script>
</body>
</html>
